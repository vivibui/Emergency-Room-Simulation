---
title: "Visualization"
author: "Vivian Bui"
date: "2023-03-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
library(tidyverse)
library(ggdark)
library(ggplot2)
library(ggforce) 
```


```{r}
# Get subset of LWBS 
LWBS <- df_p %>% filter(Time_A == "LWBS")

# Remove TBD (patients who have not yet receive a bed)
df_p <- df_p %>% filter(Time_A != "TBD")

```



```{r}
# Plot 
df_er %>%
   mutate(across(Time, factor, levels=c("0:00","1:00","2:00", "3:00","4:00","5:00", "6:00", "7:00", "8:00", "9:00","10:00","11:00","12:00", "13:00", "14:00", "15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00", "22:00", "23:00"))) %>%
    ggplot(aes(x= Waiting, fill = Method)) +
    geom_density(alpha=.45, col=NA) +
    facet_wrap(vars(Time)) +
    scale_y_continuous(name = "Frequency") + 
    scale_x_discrete(name = "Number of Waiting Patients") + 
    theme_bw() 
```



```{r}
# Since the weight of Age < 1.0, to categorize patients into Priority Groups, 
  # we can just use the Acute Level 

# Wait Time by Priority Group 
ggplot(df_p, aes(y=Total_Wait_Time, x=Method)) +
    geom_violin() + 
    scale_y_continuous(name = "Wait Time") + 
    scale_x_discrete(name = "Method") +
    theme_minimal() 

```

```{r}
# Compare the % of LWBS in each method 
df_p %>% group_by(Method) %>% 
  summarise(percent = round(sum(Time_A == "LWBS")*100/n(),2), 
            .groups = 'drop') %>% 
  ggplot(aes(x=Method, y=percent)) + 
  geom_col(width = 0.5, fill="steelblue") + 
  scale_y_continuous(name = "Percent of LWBS") + 
  scale_x_discrete(name = "Method") + 
  geom_text(size = 3, aes(label=percent), 
            position=position_dodge(width=0.9), vjust=-0.25) +
  theme_minimal()
```
```{r}
# Compare the % of LWBS in each Priority Group across method 
  # Percent calculation method: within each AcuteLv, 
  # LWBS/all patients with the same AcuteLv

df_p %>% group_by(AcuteLv, Method) %>% 
  summarise(percent = round(sum(Time_A == "LWBS")*100/n(),2), .groups = 'drop') %>% 
    ggplot(aes(x=factor(AcuteLv), y=percent, fill=Method)) + 
    geom_bar(stat="identity", position=position_dodge()) + 
    geom_text(size = 2.5, color = "black", aes(label=percent), 
              position=position_dodge(width=0.9), vjust=-0.25) + 
    scale_y_continuous(name = "Percent of LWBS (%)") + 
    scale_fill_brewer(palette="BuGn") + 
    scale_x_discrete(name = "Priority Group") + 
    theme_minimal() 

```


```{r}
# Mean Satisfaction Score by Day across Methods
df_p %>% group_by(Day_C, Method) %>% filter(Time_A != "TBD") %>% 
  summarise(mean_SF = round(mean(SF_Score),2)) %>% 
  ggplot(aes(y=factor(Day_C), x=mean_SF, fill=Method)) + 
   geom_bar(stat="identity", position=position_dodge()) +
    scale_fill_brewer(palette="BuGn") + 
    scale_x_continuous(name = "Mean Satisfaction Score") + 
    scale_y_discrete(name = "Day") + 
    geom_text(aes(label=mean_SF), position=position_dodge(width=0.9), 
              hjust=-0.5, size = 2, color="black") +
    theme_minimal() 
```

```{r}

# Mean Satisfaction Score by Priority Group across Methods
df_p %>% group_by(AcuteLv, Method) %>% filter(Time_A != "TBD") %>% 
  summarise(mean_SF = round(mean(SF_Score),2)) %>% 
  ggplot(aes(x=factor(AcuteLv), y=mean_SF, fill=Method)) + 
   geom_bar(stat="identity", position=position_dodge()) +
    scale_fill_brewer(palette="BuGn") + 
    scale_y_continuous(name = "Mean Satisfaction Score") + 
    scale_x_discrete(name = "Priority Group") + 
    geom_text(size = 3, color = 'black', aes(label=mean_SF), 
            position=position_dodge(width=0.9), vjust=-0.25)+
    theme_minimal() 
```






